<!-- Toast notifications -->
<p-toast position="top-right"></p-toast>

<div class="profile-modal">
  <!-- Modal Header - Purple gradient like dashboard -->
  <div class="modal-header">
    <div class="header-content">
      <div class="header-icon">
        <i class="material-icons">edit</i>
      </div>
      <div class="header-info">
        <h2 class="modal-title">Modifica Profilo</h2>
        <p class="modal-subtitle">Aggiorna le tue informazioni personali</p>
      </div>
    </div>
    <button class="close-btn" (click)="closeModal()" title="Chiudi">
      <span class="material-icons">close</span>
    </button>
  </div>

  <!-- Modal Body - Scrollable Content -->
  <div class="modal-body">
    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoadingData">
      <div class="loading-spinner"></div>
      <p>Caricamento dati...</p>
    </div>

    <!-- Form Content -->
    <form class="modern-form" *ngIf="!isLoadingData">
      
      <!-- ========================= 
           SEZIONE 1: INFORMAZIONI GENERALI 
           ========================= -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">
            <i class="material-icons">person</i>
          </div>
          <h4 class="section-title">Informazioni Generali</h4>
        </div>
        
        <div class="form-grid">
          <!-- Ragione Sociale (disabled) -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">business</i>
              Ragione Sociale
            </label>
            <input 
              type="text" 
              class="modern-input disabled"
              disabled
              placeholder="Ragione Sociale" 
              [value]="userData?.ragione_sociale || ''">
          </div>

          <!-- Email -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">email</i>
              Email
            </label>
            <input 
              type="email" 
              class="modern-input modal-email"
              placeholder="Email" 
              [value]="userData?.email || ''">
          </div>

          <!-- Nome -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">person</i>
              Nome
            </label>
            <input 
              type="text" 
              class="modern-input modal-nome"
              placeholder="Nome" 
              [value]="userData?.name || ''">
          </div>

          <!-- Cognome -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">person_outline</i>
              Cognome
            </label>
            <input 
              type="text" 
              class="modern-input modal-cognome"
              placeholder="Cognome" 
              [value]="userData?.cognome || ''">
          </div>
        </div>

        <!-- Immagine Profilo -->
        <div class="form-field full-width">
          <label class="modern-label">
            <i class="material-icons">photo_camera</i>
            Immagine Profilo
          </label>
          <div class="dropzone-container">
            <app-filepond-uploader uploadType="profile"></app-filepond-uploader>
          </div>
        </div>
      </div>

      <!-- ========================= 
           SEZIONE 2: SICUREZZA PASSWORD 
           ========================= -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">
            <i class="material-icons">lock</i>
          </div>
          <h4 class="section-title">Sicurezza Password</h4>
        </div>
        
        <div class="password-grid">
          <!-- Vecchia Password -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">lock_outline</i>
              Vecchia Password
            </label>
            <input 
              type="password" 
              class="modern-input modal-oldpassword"
              placeholder="Vecchia Password">
          </div>
          
          <!-- Nuova Password -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">security</i>
              Nuova Password
            </label>
            <input 
              type="password" 
              class="modern-input modal-newPassword"
              placeholder="Nuova Password">
          </div>
          
          <!-- Ripeti Nuova Password -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">verified_user</i>
              Ripeti Nuova Password
            </label>
            <input 
              type="password" 
              class="modern-input modal-repeatNewPassword"
              placeholder="Ripeti Nuova Password">
          </div>
        </div>

        <div class="button-container">
          <button 
            type="button" 
            class="modern-button password-button"
            [disabled]="isLoadingPassword"
            (click)="changePassword()">
            <i class="material-icons" *ngIf="!isLoadingPassword">security</i>
            <span class="loading-spinner-small" *ngIf="isLoadingPassword"></span>
            {{ isLoadingPassword ? 'Aggiornamento...' : 'Modifica Password' }}
          </button>
        </div>
      </div>

      <!-- ========================= 
           SEZIONE 3: INFORMAZIONI DI RESIDENZA 
           ========================= -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">
            <i class="material-icons">location_on</i>
          </div>
          <h4 class="section-title">Informazioni di Residenza</h4>
        </div>
        
        <div class="address-grid">
          <!-- Indirizzo (full width) -->
          <div class="form-field full-width">
            <label class="modern-label">
              <i class="material-icons">home</i>
              Indirizzo
            </label>
            <input 
              type="text" 
              class="modern-input modal-indirizzo"
              placeholder="Indirizzo completo" 
              [value]="userData?.indirizzo || ''">
          </div>

          <!-- Città -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">location_city</i>
              Città
            </label>
            <input 
              type="text" 
              class="modern-input modal-citta"
              placeholder="Città" 
              [value]="userData?.citta || ''">
          </div>

          <!-- Stato/Provincia -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">public</i>
              Stato/Provincia
            </label>
            <input 
              type="text" 
              class="modern-input modal-stato"
              placeholder="Stato" 
              [value]="userData?.stato || 'NON INSERITO'">
          </div>

          <!-- CAP -->
          <div class="form-field">
            <label class="modern-label">
              <i class="material-icons">markunread_mailbox</i>
              CAP
            </label>
            <input 
              type="number" 
              class="modern-input modal-cap"
              placeholder="95121" 
              [value]="userData?.cap || ''">
          </div>
        </div>
      </div>

      <!-- Pulsante Salva -->
      <div class="form-actions">
        <button 
          type="button" 
          class="modern-button save-button"
          [disabled]="isLoadingProfile"
          (click)="saveProfile()">
          <i class="material-icons" *ngIf="!isLoadingProfile">save</i>
          <span class="loading-spinner-small" *ngIf="isLoadingProfile"></span>
          {{ isLoadingProfile ? 'Salvataggio...' : 'Salva Modifiche' }}
        </button>
      </div>
    </form>
  </div>
</div>
