<div class="app-wrapper" 
     [class.sidebar-expanded]="sidebarExpanded" 
     [@pageTransition]="state">
  
  <!-- Animated Background -->
  <div class="app-background">
    <div class="bg-triangle-left"></div>
    <div class="bg-triangle-right"></div>
    <div class="bg-hexagon"></div>
    <div class="bg-hexagon-2"></div>
    <div class="bg-pattern"></div>
  </div>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" 
       [class.active]="mobileMenuOpen" 
       (click)="closeMobileMenu()">
  </div>

  <!-- Sidebar Toggle Button (external for z-index) -->
  <button class="sidebar-toggle" 
          (click)="toggleSidebar()" 
          [title]="sidebarExpanded ? 'Comprimi menu' : 'Espandi menu'">
    <span class="material-icons-round">
      {{ sidebarExpanded ? 'chevron_left' : 'chevron_right' }}
    </span>
  </button>

  <!-- Navbar with user info and events -->
  <app-navbar 
    (toggleMobileMenu)="toggleMobileMenu()"
    (openProfileModal)="openProfileModal()"
    [userName]="userName"
    [userRole]="userRole"
    [userEmail]="userEmail">
  </app-navbar>

  <!-- Sidebar -->
  <aside class="sidebar" [class.mobile-open]="mobileMenuOpen">
    <app-sidebar 
      (closeMobile)="closeMobileMenu()"
      [sidebarExpanded]="sidebarExpanded">
    </app-sidebar>
  </aside>

  <!-- Main Content -->
  <main class="main-panel">
    <div class="content">
      <router-outlet></router-outlet>
      <div id="finepagina"></div>
    </div>
  </main>

</div>
